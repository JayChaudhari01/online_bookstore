{% extends "store/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/orders/style.css' %}">
{% endblock %}

{% block title %}My Orders{% endblock %}

{% block content %}
<div class="orders-page">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">Your Orders</h1>
        <p class="page-subtitle">View and track all your orders</p>
    </div>

    {% if orders %}
    <!-- Orders List -->
    <div class="orders-container">
        {% for order in orders %}
        <div class="order-card">
            <!-- Order Header -->
            <div class="order-header">
                <div class="order-info">
                    <div class="order-meta">
                        <span class="order-label">ORDER PLACED</span>
                        <span class="order-value">{{ order.created_at|date:"d M Y" }}</span>
                    </div>
                    <div class="order-meta">
                        <span class="order-label">TOTAL</span>
                        <span class="order-value">‚Çπ{{ order.total|floatformat:2 }}</span>
                    </div>
                    <div class="order-meta">
                        <span class="order-label">SHIP TO</span>
                        <span class="order-value">{{ order.full_name }}</span>
                    </div>
                </div>
                <div class="order-id">
                    <span class="order-label">ORDER ID: #{{ order.id }}</span>
                </div>
            </div>

            <!-- Order Status Bar -->
            <div class="order-status-bar">
                <div class="status-badge status-{{ order.status|lower }}">
                    <span class="status-icon">
                        {% if order.status == "Pending" %}‚è≥
                        {% elif order.status == "Shipped" %}üöö
                        {% elif order.status == "Delivered" %}‚úÖ
                        {% elif order.status == "Cancelled" %}‚ùå
                        {% else %}üì¶{% endif %}
                    </span>
                    <span class="status-text">{{ order.status }}</span>
                </div>
                <div class="payment-method">
                    <span class="payment-icon">üí≥</span>
                    <span>{{ order.payment_method }}</span>
                </div>
            </div>

            <!-- Order Items -->
            <div class="order-items">
                {% for item in order.items.all %}
                <div class="order-item">
                    <div class="item-image">
                        {% if item.book.image %}
                        <img src="{{ item.book.image.url }}" alt="{{ item.book.title }}">
                        {% else %}
                        <div class="item-placeholder">üìö</div>
                        {% endif %}
                    </div>
                    <div class="item-details">
                        <h4 class="item-title">{{ item.book.title }}</h4>
                        <p class="item-author">by {{ item.book.author }}</p>
                        <div class="item-meta">
                            <span class="item-qty">Qty: {{ item.quantity }}</span>
                            <span class="item-price">‚Çπ{{ item.price|floatformat:2 }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Delivery Address -->
            <div class="delivery-info">
                <div class="delivery-header">
                    <span class="delivery-icon">üìç</span>
                    <h4>Delivery Address</h4>
                </div>
                <div class="delivery-address">
                    <p class="address-name">{{ order.full_name }}</p>
                    <p class="address-line">{{ order.address }}</p>
                    <p class="address-city">{{ order.city }}, {{ order.pincode }}</p>
                    <p class="address-phone">Phone: {{ order.phone }}</p>
                </div>
            </div>

            <!-- Order Timeline -->
            <div class="order-timeline">
                <div class="timeline-step {% if order.status == 'Pending' or order.status == 'Shipped' or order.status == 'Delivered' %}completed{% endif %}">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-title">Order Placed</span>
                        <span class="timeline-date">{{ order.created_at|date:"d M Y, g:i A" }}</span>
                    </div>
                </div>
                <div class="timeline-step {% if order.status == 'Shipped' or order.status == 'Delivered' %}completed{% endif %}">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-title">Shipped</span>
                        <span class="timeline-date">{% if order.status == 'Shipped' or order.status == 'Delivered' %}In Transit{% endif %}</span>
                    </div>
                </div>
                <div class="timeline-step {% if order.status == 'Delivered' %}completed{% endif %}">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-title">Delivered</span>
                        <span class="timeline-date">{% if order.status == 'Delivered' %}Completed{% endif %}</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <!-- Empty State -->
    <div class="empty-orders">
        <div class="empty-icon">üì¶</div>
        <h2 class="empty-title">No Orders Yet</h2>
        <p class="empty-message">You haven't placed any orders. Start shopping to see your orders here.</p>
        <a href="{% url 'book_list' %}" class="shop-now-btn">
            <span>Start Shopping</span>
            <span class="shop-arrow">‚Üí</span>
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}